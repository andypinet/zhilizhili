{"version":3,"names":[],"mappings":"","sources":["about/my_class/item.js"],"sourcesContent":["export default function(superClass) {\n\t\textend(item, superClass);\n\n\t\tfunction item(rank) {\n\t\t\tthis.isHitTarget = bind(this.isHitTarget, this);\n\t\t\tthis.isContainStage = bind(this.isContainStage, this);\n\t\t\tthis.get3dObject = bind(this.get3dObject, this);\n\t\t\tthis.rank = bind(this.rank, this);\n\t\t\tthis._getItemRank = bind(this._getItemRank, this);\n\t\t\tthis._makeHitEffectObject = bind(this._makeHitEffectObject, this);\n\t\t\tthis._makeHitObject = bind(this._makeHitObject, this);\n\t\t\tthis.hide = bind(this.hide, this);\n\t\t\tthis.hitAnimation = bind(this.hitAnimation, this);\n\t\t\tthis.isDead = bind(this.isDead, this);\n\t\t\tthis.show = bind(this.show, this);\n\t\t\tthis.dispose = bind(this.dispose, this);\n\t\t\tthis._updateHit = bind(this._updateHit, this);\n\t\t\tthis._updateShow = bind(this._updateShow, this);\n\t\t\tthis.update = bind(this.update, this);\n\t\t\tthis._makeShowEffectMesh = bind(this._makeShowEffectMesh, this);\n\t\t\tthis.start = bind(this.start, this);\n\t\t\titem.__super__.constructor.call(this);\n\t\t\tthis._rank = rank;\n\t\t\tthis._cnt = 0;\n\t\t\tthis._cntMax = 0;\n\t\t\tthis._cntDead = 0;\n\t\t\tthis._cntDeadMax = 0;\n\t\t\tthis._obj;\n\t\t\tthis._showLine;\n\t\t\tthis._hit;\n\t\t\tthis._prtcl;\n\t\t\tthis._comboPrtcl;\n\t\t\tthis._hitObject = [];\n\t\t\tthis._hitEffectParam = [];\n\t\t\tthis._hitParam = {};\n\t\t\tthis._showParam = {};\n\t\t\tthis._showEffect = [];\n\t\t\tthis._scale = 5;\n\t\t\tthis._isPlayingHitAnimation = false;\n\t\t}\n\n\t\titem.prototype.start = function() {\n\t\t\tvar orgObj;\n\t\t\titem.__super__.start.call(this);\n\t\t\torgObj = this._data.getCmnObj3D(\"item\" + String(this._rank));\n\t\t\tthis._obj = orgObj.clone();\n\t\t\tthis._container.add(this._obj);\n\t\t\tthis._makeShowEffectMesh();\n\t\t\tthis._makeHitObject();\n\t\t\tthis._container.visible = false;\n\t\t\tthis._hitParam.anm = new root._LIBS.animation();\n\t\t\tthis._hitEffectParam[0] = {\n\t\t\t\tanm: new root._LIBS.animation()\n\t\t\t};\n\t\t\tif (!this._isSmt) {\n\t\t\t\tthis._hitEffectParam[1] = {\n\t\t\t\t\tanm: new root._LIBS.animation()\n\t\t\t\t};\n\t\t\t}\n\t\t\tthis._makeHitEffectObject();\n\t\t\tthis._prtcl = new root.MY_CLASS.hit();\n\t\t\tthis._prtcl.start();\n\t\t\tthis._container.add(this._prtcl.container());\n\t\t\tthis._prtcl.setColor(this._conf.ITEM_COLOR[this._rank]);\n\t\t\tthis._comboPrtcl = new root.MY_CLASS.prtclCombo();\n\t\t\tthis._comboPrtcl.start();\n\t\t\tthis._container.add(this._comboPrtcl.container());\n\t\t\tthis._comboPrtcl.setColor(this._conf.ITEM_COLOR[this._rank]);\n\t\t\tthis._showLine = new root.MY_CLASS.drawingLine(this._conf.ITEM_COLOR[this._rank], 20);\n\t\t\tthis._showLine.start();\n\t\t\tthis._container.add(this._showLine.container());\n\t\t\treturn this._showParam.anm = new root._LIBS.animation();\n\t\t};\n\n\t\titem.prototype._makeShowEffectMesh = function() {\n\t\t\tvar geometry, material, obj, radius;\n\t\t\tradius = 20;\n\t\t\tgeometry = new THREE.CircleGeometry(radius, 32);\n\t\t\tmaterial = new THREE.MeshBasicMaterial({\n\t\t\t\tcolor: this._conf.ITEM_COLOR[this._rank],\n\t\t\t\ttransparent: true,\n\t\t\t\topacity: 1,\n\t\t\t\tdepthTest: false,\n\t\t\t\tblending: THREE.AdditiveBlending\n\t\t\t});\n\t\t\tobj = new THREE.Mesh(geometry, material);\n\t\t\tthis._container.add(obj);\n\t\t\tobj.visible = false;\n\t\t\tthis._showEffect[0] = obj;\n\t\t\treturn this._showEffect[1] = new root._LIBS.animation();\n\t\t};\n\n\t\titem.prototype.update = function() {\n\t\t\titem.__super__.update.call(this);\n\t\t\tif (this._container.visible) {\n\t\t\t\tthis._cnt++;\n\t\t\t\tif (this._isPlayingHitAnimation) {\n\t\t\t\t\treturn this._updateHit();\n\t\t\t\t} else {\n\t\t\t\t\treturn this._updateShow();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\titem.prototype._updateShow = function() {\n\t\t\tvar anm, obj, s;\n\t\t\tif (!this._showParam.anm.isCompleted() || !this._showEffect[1].isCompleted()) {\n\t\t\t\tthis._obj.rotation.x = this._showParam.anm.get(\"rx\");\n\t\t\t\tthis._obj.rotation.y = this._showParam.anm.get(\"ry\");\n\t\t\t\tthis._obj.rotation.z = this._showParam.anm.get(\"rz\");\n\t\t\t\ts = this._showParam.anm.get(\"scale\");\n\t\t\t\tthis._obj.scale.set(s, s, s);\n\t\t\t\tanm = this._showEffect[1];\n\t\t\t\tif (!anm.isCompleted() && anm.isStart()) {\n\t\t\t\t\tobj = this._showEffect[0];\n\t\t\t\t\tobj.visible = true;\n\t\t\t\t\ts = anm.get(\"scale\");\n\t\t\t\t\tobj.scale.set(s, s, s);\n\t\t\t\t\tif (anm.isCompleted()) {\n\t\t\t\t\t\treturn obj.visible = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\titem.prototype._updateHit = function() {\n\t\t\tvar compCnt, i, j, len1, obj, ref, s, val;\n\t\t\tthis._cntDead++;\n\t\t\tthis._obj.rotation.x = this._hitParam.anm.get(\"rx\");\n\t\t\tthis._obj.rotation.y = this._hitParam.anm.get(\"ry\");\n\t\t\tthis._obj.rotation.z = this._hitParam.anm.get(\"rz\");\n\t\t\ts = this._hitParam.anm.get(\"scale\");\n\t\t\tthis._obj.scale.set(s, s, s);\n\t\t\tcompCnt = 0;\n\t\t\tref = this._hitEffectParam;\n\t\t\tfor (i = j = 0, len1 = ref.length; j < len1; i = ++j) {\n\t\t\t\tval = ref[i];\n\t\t\t\tobj = this._hitObject[i];\n\t\t\t\ts = val.anm.get(\"scale\");\n\t\t\t\tobj.scale.set(s, s, s);\n\t\t\t\tobj.material.opacity = val.anm.get(\"opacity\");\n\t\t\t\tobj.material.needsUpdate = true;\n\t\t\t\tif (val.anm.isCompleted()) {\n\t\t\t\t\tcompCnt++;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this._hitParam.anm.isCompleted() && compCnt >= this._hitEffectParam.length) {\n\t\t\t\tthis._isPlayingHitAnimation = false;\n\t\t\t\treturn this._container.visible = false;\n\t\t\t}\n\t\t};\n\n\t\titem.prototype.dispose = function() {\n\t\t\tif (this._obj != null) {\n\t\t\t\tthis._container.remove(this._obj);\n\t\t\t\tthis._obj = null;\n\t\t\t}\n\t\t\tif (this._hit != null) {\n\t\t\t\tthis._container.remove(this._hit);\n\t\t\t\tthis._hit.material.dispose();\n\t\t\t\tthis._hit.geometry.dispose();\n\t\t\t\tthis._hit = null;\n\t\t\t}\n\t\t\treturn item.__super__.dispose.call(this);\n\t\t};\n\n\t\titem.prototype.show = function(pos, delay, interval) {\n\t\t\tvar i, j, len1, lineHideDelay, onpuShowDelay, ref, val;\n\t\t\tdelay *= interval || 13;\n\t\t\tthis._container.visible = true;\n\t\t\tthis._hit.visible = true;\n\t\t\tref = this._hitObject;\n\t\t\tfor (i = j = 0, len1 = ref.length; j < len1; i = ++j) {\n\t\t\t\tval = ref[i];\n\t\t\t\tval.visible = false;\n\t\t\t}\n\t\t\tthis._obj.rotation.x = 0;\n\t\t\tthis._obj.rotation.y = 0;\n\t\t\tthis._obj.rotation.z = this._u.radian(90 + this._u.range(30));\n\t\t\tthis._obj.scale.set(0.001, 0.001, 0.001);\n\t\t\tthis._container.position.copy(pos);\n\t\t\tthis._obj.visible = true;\n\t\t\tthis._isPlayingHitAnimation = false;\n\t\t\tthis._hitParam.anm.reset();\n\t\t\tlineHideDelay = delay + 40;\n\t\t\tonpuShowDelay = lineHideDelay + 20;\n\t\t\tthis._showParam.anm.set({\n\t\t\t\trx: {\n\t\t\t\t\tfrom: this._obj.rotation.x,\n\t\t\t\t\tto: this._u.radian(this._u.range(0))\n\t\t\t\t},\n\t\t\t\try: {\n\t\t\t\t\tfrom: this._obj.rotation.y,\n\t\t\t\t\tto: this._u.radian(this._u.range(0))\n\t\t\t\t},\n\t\t\t\trz: {\n\t\t\t\t\tfrom: this._obj.rotation.z,\n\t\t\t\t\tto: this._u.radian(90)\n\t\t\t\t},\n\t\t\t\tscale: {\n\t\t\t\t\tfrom: 0.01,\n\t\t\t\t\tto: this._scale\n\t\t\t\t},\n\t\t\t\tframe: 30,\n\t\t\t\tdelay: onpuShowDelay,\n\t\t\t\tease: \"bounceOut\"\n\t\t\t});\n\t\t\tthis._showParam.anm.start();\n\t\t\tthis._showEffect[1].set({\n\t\t\t\tscale: {\n\t\t\t\t\tfrom: [3.5, 2][this._device],\n\t\t\t\t\tto: [0.01, 0.01][this._device]\n\t\t\t\t},\n\t\t\t\topacity: {\n\t\t\t\t\tfrom: 1,\n\t\t\t\t\tto: 0\n\t\t\t\t},\n\t\t\t\tframe: [30, 40][this._device],\n\t\t\t\tdelay: [onpuShowDelay - 5, onpuShowDelay - 5][this._device],\n\t\t\t\tease: \"easeOutExpo\"\n\t\t\t});\n\t\t\tthis._showEffect[1].start();\n\t\t\tthis._showEffect[0].visible = false;\n\t\t\tthis._showLine.show(70, delay, 40, lineHideDelay);\n\t\t\tthis._prtcl.hide();\n\t\t\tthis._comboPrtcl.hide();\n\t\t\tthis._cnt = 0;\n\t\t\treturn this._cntMax = [onpuShowDelay + 5, onpuShowDelay - 10][this._device];\n\t\t};\n\n\t\titem.prototype.isDead = function() {\n\t\t\tif (!this._container.visible || (this._isPlayingHitAnimation && this._cntDead >= this._cntDeadMax)) {\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t};\n\n\t\titem.prototype.hitAnimation = function(combo) {\n\t\t\tvar color, delay, ease, frame, i, j, len1, obj, op0, op1, ref, s0, s1, val;\n\t\t\tif (this._isPlayingHitAnimation) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._isPlayingHitAnimation = true;\n\t\t\tthis._cntDead = 0;\n\t\t\tthis._cntDeadMax = 30;\n\t\t\tthis._hitParam.anm.set({\n\t\t\t\trx: {\n\t\t\t\t\tfrom: this._obj.rotation.x,\n\t\t\t\t\tto: this._obj.rotation.x + this._u.radian(this._u.range(80))\n\t\t\t\t},\n\t\t\t\try: {\n\t\t\t\t\tfrom: this._obj.rotation.y,\n\t\t\t\t\tto: this._obj.rotation.y + this._u.radian(this._u.range(80))\n\t\t\t\t},\n\t\t\t\trz: {\n\t\t\t\t\tfrom: this._obj.rotation.z,\n\t\t\t\t\tto: this._obj.rotation.z + this._u.radian(330)\n\t\t\t\t},\n\t\t\t\tscale: {\n\t\t\t\t\tfrom: this._scale,\n\t\t\t\t\tto: 0.0001\n\t\t\t\t},\n\t\t\t\tframe: [30, 15][this._device],\n\t\t\t\tease: \"easeInOutExpo\"\n\t\t\t});\n\t\t\tthis._hitParam.anm.start();\n\t\t\tcolor = this._conf.ITEM_COLOR[this._rank];\n\t\t\tref = this._hitEffectParam;\n\t\t\tfor (i = j = 0, len1 = ref.length; j < len1; i = ++j) {\n\t\t\t\tval = ref[i];\n\t\t\t\tswitch (i) {\n\t\t\t\t\tcase 0:\n\t\t\t\t\t\tif (!this._isSmt) {\n\t\t\t\t\t\t\ts0 = [9, 16, 30][~~((combo - 1) / 3)];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ts0 = [8, 16, 16][~~((combo - 1) / 3)];\n\t\t\t\t\t\t}\n\t\t\t\t\t\ts1 = 0.001;\n\t\t\t\t\t\top0 = 1;\n\t\t\t\t\t\top1 = op0;\n\t\t\t\t\t\tframe = 50;\n\t\t\t\t\t\tdelay = [1, 0][this._device];\n\t\t\t\t\t\tease = \"easeOutExpo\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\ts0 = 0.1;\n\t\t\t\t\t\ts1 = this._u.map(combo, 5, 20, 1, 7);\n\t\t\t\t\t\top0 = 1;\n\t\t\t\t\t\top1 = 0;\n\t\t\t\t\t\tframe = 80;\n\t\t\t\t\t\tdelay = 0;\n\t\t\t\t\t\tease = \"easeOutExpo\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\ts0 = 1;\n\t\t\t\t\t\ts1 = this._u.map(combo, 2, 6, 1, 7);\n\t\t\t\t\t\top0 = 1;\n\t\t\t\t\t\top1 = 0;\n\t\t\t\t\t\tframe = 30;\n\t\t\t\t\t\tdelay = 0;\n\t\t\t\t\t\tease = \"easeInExpo\";\n\t\t\t\t}\n\t\t\t\tval.anm.set({\n\t\t\t\t\tscale: {\n\t\t\t\t\t\tfrom: s0,\n\t\t\t\t\t\tto: s1\n\t\t\t\t\t},\n\t\t\t\t\topacity: {\n\t\t\t\t\t\tfrom: op0,\n\t\t\t\t\t\tto: op1\n\t\t\t\t\t},\n\t\t\t\t\tframe: frame,\n\t\t\t\t\tdelay: delay,\n\t\t\t\t\tease: ease\n\t\t\t\t});\n\t\t\t\tval.anm.start();\n\t\t\t\tobj = this._hitObject[i];\n\t\t\t\tobj.material.setValues({\n\t\t\t\t\tcolor: color,\n\t\t\t\t\topacity: op0\n\t\t\t\t});\n\t\t\t\tobj.material.needsUpdate = true;\n\t\t\t\tobj.visible = true;\n\t\t\t}\n\t\t\tthis._showEffect[0].visible = false;\n\t\t\tthis._showLine.hide();\n\t\t\tthis._hit.visible = false;\n\t\t\tthis.update();\n\t\t\tthis._prtcl.show(combo);\n\t\t\tif (combo >= 3 && !this._isSmt) {\n\t\t\t\treturn this._comboPrtcl.show(combo);\n\t\t\t}\n\t\t};\n\n\t\titem.prototype.hide = function() {\n\t\t\titem.__super__.hide.call(this);\n\t\t\tthis._showEffect[0].visible = false;\n\t\t\tthis._showLine.hide();\n\t\t\tthis._hit.visible = false;\n\t\t\tthis._isPlayingHitAnimation = false;\n\t\t\tthis._prtcl.hide();\n\t\t\treturn this._comboPrtcl.hide();\n\t\t};\n\n\t\titem.prototype._makeHitObject = function() {\n\t\t\tvar geometry, material, size;\n\t\t\tsize = [80, 80][this._device];\n\t\t\tgeometry = new THREE.PlaneBufferGeometry(size, size);\n\t\t\tmaterial = new THREE.MeshBasicMaterial({\n\t\t\t\tcolor: 0xff0000,\n\t\t\t\ttransparent: true,\n\t\t\t\topacity: 0,\n\t\t\t\tblending: THREE.NormalBlending,\n\t\t\t\tdepthTest: false\n\t\t\t});\n\t\t\tthis._hit = new THREE.Mesh(geometry, material);\n\t\t\treturn this._container.add(this._hit);\n\t\t};\n\n\t\titem.prototype._makeHitEffectObject = function() {\n\t\t\tvar geometry, i, material, num, obj, radius, results;\n\t\t\ti = 0;\n\t\t\tnum = this._hitEffectParam.length;\n\t\t\tresults = [];\n\t\t\twhile (i < num) {\n\t\t\t\tswitch (i) {\n\t\t\t\t\tcase 0:\n\t\t\t\t\t\tradius = [5, 2.5][this._device];\n\t\t\t\t\t\tgeometry = new THREE.CircleGeometry(radius, 32);\n\t\t\t\t\t\tmaterial = new THREE.MeshBasicMaterial({\n\t\t\t\t\t\t\tcolor: 0xffffff,\n\t\t\t\t\t\t\ttransparent: true,\n\t\t\t\t\t\t\topacity: 0,\n\t\t\t\t\t\t\tdepthTest: false,\n\t\t\t\t\t\t\tblending: THREE.CustomBlending,\n\t\t\t\t\t\t\tblendSrc: THREE[this._conf.BLEND[7]],\n\t\t\t\t\t\t\tblendDst: THREE[this._conf.BLEND[1]],\n\t\t\t\t\t\t\tblendEquation: THREE.AddEquation\n\t\t\t\t\t\t});\n\t\t\t\t\t\tobj = new THREE.Mesh(geometry, material);\n\t\t\t\t\t\tthis._container.add(obj);\n\t\t\t\t\t\tthis._hitObject.push(obj);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\tgeometry = new THREE.TorusGeometry(6, 0.05, 32, 32);\n\t\t\t\t\t\tmaterial = new THREE.MeshBasicMaterial({\n\t\t\t\t\t\t\tcolor: 0xffffff,\n\t\t\t\t\t\t\ttransparent: true,\n\t\t\t\t\t\t\topacity: 0,\n\t\t\t\t\t\t\tdepthTest: false,\n\t\t\t\t\t\t\tblending: THREE.AdditiveBlending\n\t\t\t\t\t\t});\n\t\t\t\t\t\tobj = new THREE.Mesh(geometry, material);\n\t\t\t\t\t\tthis._container.add(obj);\n\t\t\t\t\t\tthis._hitObject.push(obj);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\tgeometry = new THREE.TorusGeometry(6, 1, 32, 32);\n\t\t\t\t\t\tmaterial = new THREE.MeshBasicMaterial({\n\t\t\t\t\t\t\tcolor: 0xffffff,\n\t\t\t\t\t\t\ttransparent: true,\n\t\t\t\t\t\t\topacity: 0,\n\t\t\t\t\t\t\tblending: THREE.NormalBlending,\n\t\t\t\t\t\t\tdepthTest: false\n\t\t\t\t\t\t});\n\t\t\t\t\t\tobj = new THREE.Mesh(geometry, material);\n\t\t\t\t\t\tthis._container.add(obj);\n\t\t\t\t\t\tthis._hitObject.push(obj);\n\t\t\t\t}\n\t\t\t\tresults.push(i++);\n\t\t\t}\n\t\t\treturn results;\n\t\t};\n\n\t\titem.prototype._getItemRank = function() {\n\t\t\tif (this._u.hit(15)) {\n\t\t\t\treturn 2;\n\t\t\t} else {\n\t\t\t\tif (this._u.hit(3)) {\n\t\t\t\t\treturn 1;\n\t\t\t\t} else {\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\titem.prototype.rank = function() {\n\t\t\treturn this._rank;\n\t\t};\n\n\t\titem.prototype.get3dObject = function() {\n\t\t\treturn this._hit;\n\t\t};\n\n\t\titem.prototype.isContainStage = function() {\n\t\t\tvar frustum;\n\t\t\tif (this.isDead()) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (this._isPlayingHitAnimation) {\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\tfrustum = new THREE.Frustum();\n\t\t\t\tfrustum.setFromMatrix(new THREE.Matrix4().multiplyMatrices(this._camera.projectionMatrix, this._camera.matrixWorldInverse));\n\t\t\t\treturn this._container.visible && frustum.containsPoint(this._container.position);\n\t\t\t}\n\t\t};\n\n\t\titem.prototype.isHitTarget = function() {\n\t\t\treturn this.isContainStage() && !this._isPlayingHitAnimation && this._cnt >= this._cntMax;\n\t\t};\n\n\t\treturn item;\n\n\t}"],"file":"about/my_class/item.js","sourceRoot":"/source/"}