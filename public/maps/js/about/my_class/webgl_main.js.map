{"version":3,"names":[],"mappings":"","sources":["about/my_class/webgl_main.js"],"sourcesContent":["export default function() {\n\t\tfunction webglMain() {\n\t\t\tthis.isPostEffect = bind(this.isPostEffect, this);\n\t\t\tthis._eStartNextStage = bind(this._eStartNextStage, this);\n\t\t\tthis._eEnterNextStage = bind(this._eEnterNextStage, this);\n\t\t\tthis._eCompleteNextData = bind(this._eCompleteNextData, this);\n\t\t\tthis._eSetupNextStage = bind(this._eSetupNextStage, this);\n\t\t\tthis._eEnterLoopArea = bind(this._eEnterLoopArea, this);\n\t\t\tthis._eEndStage = bind(this._eEndStage, this);\n\t\t\tthis._eGetItem = bind(this._eGetItem, this);\n\t\t\tthis._update = bind(this._update, this);\n\t\t\tthis._resize = bind(this._resize, this);\n\t\t\tthis.resetGame = bind(this.resetGame, this);\n\t\t\tthis.stopGame = bind(this.stopGame, this);\n\t\t\tthis.startGame = bind(this.startGame, this);\n\t\t\tthis._eClickTopStart = bind(this._eClickTopStart, this);\n\t\t\tthis._eCompletePostEffect = bind(this._eCompletePostEffect, this);\n\t\t\tthis.startZoomAnimation = bind(this.startZoomAnimation, this);\n\t\t\tthis.startBrightAnimation = bind(this.startBrightAnimation, this);\n\t\t\tthis.disposeTop = bind(this.disposeTop, this);\n\t\t\tthis.makeTop = bind(this.makeTop, this);\n\t\t\tthis.makeRoad = bind(this.makeRoad, this);\n\t\t\tthis.start = bind(this.start, this);\n\t\t\tthis._scene;\n\t\t\tthis._camera;\n\t\t\tthis._ambLight;\n\t\t\tthis._dLight;\n\t\t\tthis._renderer;\n\t\t\tthis._u = root.MY.myfw.util;\n\t\t\tthis._conf = root.MY.app.conf;\n\t\t\tthis._isSmt = root.MY.myfw.conf.IS_SMT;\n\t\t\tthis._device = this._isSmt ? 1 : 0;\n\t\t\tthis._top;\n\t\t\tthis._road;\n\t\t\tthis._parameter;\n\t\t\tthis._data;\n\t\t\tthis._game;\n\t\t\tthis._composer;\n\t\t\tthis._shader = [];\n\t\t\tthis._brightAnm;\n\t\t\tthis._zoomAnm;\n\t\t\tthis._isPostEffect = false;\n\t\t\tthis._postEffectType = 0;\n\t\t\tthis.onStart;\n\t\t\tthis.onGetItem;\n\t\t\tthis._delayCall;\n\t\t}\n\n\t\twebglMain.prototype.start = function() {\n\t\t\tthis._delayCall = new root.MY_CLASS.delayCall();\n\t\t\tthis._delayCall.start();\n\t\t\tthis._brightAnm = new root._LIBS.animation();\n\t\t\tthis._zoomAnm = new root._LIBS.animation();\n\t\t\tthis._parameter = root.MY.gl.parameter;\n\t\t\tthis._data = root.MY.gl.data;\n\t\t\tthis._game = root.MY.gl.game;\n\t\t\tthis._scene = new THREE.Scene();\n\t\t\tthis._camera = new THREE.PerspectiveCamera(this._conf.FAV, window.innerWidth / window.innerHeight, 1, this._conf.CAMERA_FAR[this._device]);\n\t\t\tthis._ambLight = new THREE.AmbientLight(0xffffff);\n\t\t\tthis._scene.add(this._ambLight);\n\t\t\tthis._ambLight.position.set(0, 0, 0);\n\t\t\tthis._renderer = new THREE.WebGLRenderer({\n\t\t\t\tantialias: false\n\t\t\t});\n\t\t\tif (window.devicePixelRatio != null) {\n\t\t\t\tthis._renderer.setPixelRatio(window.devicePixelRatio);\n\t\t\t}\n\t\t\tthis._renderer.setClearColor(this._conf.BG_COLOR[0]);\n\t\t\tthis._renderer.setSize(window.innerWidth, window.innerHeight);\n\t\t\tdocument.body.appendChild(this._renderer.domElement);\n\t\t\tthis._composer = new THREE.EffectComposer(this._renderer);\n\t\t\tthis._composer.addPass(new THREE.RenderPass(this._scene, this._camera));\n\t\t\tthis._shader[0] = new THREE.ShaderPass(THREE.ZoomBlurShader);\n\t\t\tthis._composer.addPass(this._shader[0]);\n\t\t\tthis._shader[1] = new THREE.ShaderPass(THREE.BrightnessContrastShader);\n\t\t\tthis._shader[1].renderToScreen = true;\n\t\t\tthis._composer.addPass(this._shader[1]);\n\t\t\troot.MY.gl.scene = this._scene;\n\t\t\troot.MY.gl.camera = this._camera;\n\t\t\troot.MY.myfw.addResize(this._resize);\n\t\t\troot.MY.myfw.addUpdate(this._update);\n\t\t\treturn this._resize();\n\t\t};\n\n\t\twebglMain.prototype.makeRoad = function() {\n\t\t\tthis._road = new root.MY_CLASS.road();\n\t\t\tthis._road.onSetupNextStage = this._eSetupNextStage;\n\t\t\tthis._road.onEndStage = this._eEndStage;\n\t\t\tthis._road.onGetItem = this._eGetItem;\n\t\t\tthis._road.onStartNextStage = this._eStartNextStage;\n\t\t\tthis._road.onEnterNextStage = this._eEnterNextStage;\n\t\t\tthis._road.onEnterLoopArea = this._eEnterLoopArea;\n\t\t\tthis._road.start();\n\t\t\treturn this._road.isDraw(false);\n\t\t};\n\n\t\twebglMain.prototype.makeTop = function() {\n\t\t\tthis._top = new root.MY_CLASS.topView();\n\t\t\tthis._top.onClickStart = this._eClickTopStart;\n\t\t\treturn this._top.start();\n\t\t};\n\n\t\twebglMain.prototype.disposeTop = function() {\n\t\t\tif (this._top != null) {\n\t\t\t\tthis._top.dispose();\n\t\t\t\treturn this._top = null;\n\t\t\t}\n\t\t};\n\n\t\twebglMain.prototype.startBrightAnimation = function(f, d, e, from, to, isResetPostEffect) {\n\t\t\tif (to == null) {\n\t\t\t\tto = 0;\n\t\t\t}\n\t\t\tif (isResetPostEffect == null) {\n\t\t\t\tisResetPostEffect = true;\n\t\t\t}\n\t\t\tthis.isPostEffect(true);\n\t\t\tthis._brightAnm.set({\n\t\t\t\tbrightness: {\n\t\t\t\t\tfrom: from,\n\t\t\t\t\tto: to\n\t\t\t\t},\n\t\t\t\tframe: f,\n\t\t\t\tdelay: d,\n\t\t\t\tease: e || \"easeOutExpo\",\n\t\t\t\tonComplete: isResetPostEffect ? this._eCompletePostEffect : null\n\t\t\t});\n\t\t\treturn this._brightAnm.start();\n\t\t};\n\n\t\twebglMain.prototype.startZoomAnimation = function(f0, f1, d, t) {\n\t\t\tthis.isPostEffect(true);\n\t\t\tthis._zoomAnm.set({\n\t\t\t\tstrength: {\n\t\t\t\t\tfrom: 0,\n\t\t\t\t\tto: t\n\t\t\t\t},\n\t\t\t\tframe: f0,\n\t\t\t\tdelay: d || 0,\n\t\t\t\tease: \"easeOutExpo\",\n\t\t\t\tonComplete: (function(_this) {\n\t\t\t\t\treturn function() {\n\t\t\t\t\t\t_this._zoomAnm.set({\n\t\t\t\t\t\t\tstrength: {\n\t\t\t\t\t\t\t\tfrom: t,\n\t\t\t\t\t\t\t\tto: 0\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tframe: f1,\n\t\t\t\t\t\t\tdelay: 0,\n\t\t\t\t\t\t\tease: \"easeOutExpo\",\n\t\t\t\t\t\t\tonComplete: _this._eCompletePostEffect\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn _this._zoomAnm.start();\n\t\t\t\t\t};\n\t\t\t\t})(this)\n\t\t\t});\n\t\t\treturn this._zoomAnm.start();\n\t\t};\n\n\t\twebglMain.prototype._eCompletePostEffect = function() {\n\t\t\treturn this.isPostEffect(false);\n\t\t};\n\n\t\twebglMain.prototype._eClickTopStart = function() {\n\t\t\tif (this.onStart != null) {\n\t\t\t\treturn this.onStart();\n\t\t\t}\n\t\t};\n\n\t\twebglMain.prototype.startGame = function() {\n\t\t\tthis.isPostEffect(false);\n\t\t\tthis.disposeTop();\n\t\t\tthis._road.makeRoad();\n\t\t\tthis._road.startRun();\n\t\t\tthis._road.isDraw(true);\n\t\t\tthis._update();\n\t\t\treturn root.MY.gl.ui.musicTitle().showTitle(this._game.stageId());\n\t\t};\n\n\t\twebglMain.prototype.stopGame = function() {\n\t\t\treturn this._road.stopRun();\n\t\t};\n\n\t\twebglMain.prototype.resetGame = function() {\n\t\t\treturn this._road.reset();\n\t\t};\n\n\t\twebglMain.prototype._resize = function() {\n\t\t\tvar h, w;\n\t\t\tw = root.MY.myfw.stageWidth();\n\t\t\th = root.MY.myfw.stageHeight();\n\t\t\tthis._camera.aspect = w / h;\n\t\t\tthis._camera.updateProjectionMatrix();\n\t\t\tthis._renderer.setSize(w, h);\n\t\t\tif ((this._composer != null) && this._isPostEffect) {\n\t\t\t\treturn this._composer.setSize(w, h);\n\t\t\t}\n\t\t};\n\n\t\twebglMain.prototype._update = function() {\n\t\t\tvar zoomBlur;\n\t\t\tthis._camera.fov = this._parameter.get(\"fov\");\n\t\t\tthis._camera.updateProjectionMatrix();\n\t\t\tif (this._isPostEffect) {\n\t\t\t\tif (this._brightAnm != null) {\n\t\t\t\t\tthis._shader[1].uniforms['brightness'].value = this._brightAnm.get(\"brightness\");\n\t\t\t\t} else {\n\t\t\t\t\tthis._shader[1].uniforms['brightness'].value = 1;\n\t\t\t\t}\n\t\t\t\tthis._shader[1].uniforms['contrast'].value = 0;\n\t\t\t\tzoomBlur = this._shader[0];\n\t\t\t\tif ((this._zoomAnm != null) && !this._zoomAnm.isCompleted()) {\n\t\t\t\t\tzoomBlur.uniforms[\"strength\"].value = this._zoomAnm.get(\"strength\");\n\t\t\t\t} else {\n\t\t\t\t\tzoomBlur.uniforms[\"strength\"].value = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this._isPostEffect) {\n\t\t\t\treturn this._composer.render();\n\t\t\t} else {\n\t\t\t\treturn this._renderer.render(this._scene, this._camera);\n\t\t\t}\n\t\t};\n\n\t\twebglMain.prototype._eGetItem = function(rank, combo) {\n\t\t\tif (this.onGetItem != null) {\n\t\t\t\treturn this.onGetItem(rank, combo);\n\t\t\t}\n\t\t};\n\n\t\twebglMain.prototype._eEndStage = function() {\n\t\t\treturn this._game.waitGame();\n\t\t};\n\n\t\twebglMain.prototype._eEnterLoopArea = function() {\n\t\t\troot.MY.gl.ui.stgInterval().showClear(this._game.clearStageNum() + 1);\n\t\t\troot.MY.gl.ui.musicTitle().hideTitle();\n\t\t\tif (!this._isSmt) {\n\t\t\t\treturn this.startZoomAnimation(60, 160, 0, 1.3);\n\t\t\t}\n\t\t};\n\n\t\twebglMain.prototype._eSetupNextStage = function() {\n\t\t\troot.MY.gl.ui.stgInterval().hideClear();\n\t\t\troot.MY.gl.ui.stgInterval().showNext();\n\t\t\tthis._data.onCompleteNextData = this._eCompleteNextData;\n\t\t\treturn this._data.loadNextStage(this._game.nextStageId(), this._game.nextGameId(), true);\n\t\t};\n\n\t\twebglMain.prototype._eCompleteNextData = function() {\n\t\t\troot.MY.gl.ui.stgInterval().hideNext();\n\t\t\troot.MY.gl.ui.stgInterval().showTitle(this._game.clearStageNum() + 1);\n\t\t\tthis._delayCall.onComplete = (function(_this) {\n\t\t\t\treturn function() {\n\t\t\t\t\t_this._game.goNextStage();\n\t\t\t\t\treturn _this._road.goNextStage();\n\t\t\t\t};\n\t\t\t})(this);\n\t\t\treturn this._delayCall.watchStart(30);\n\t\t};\n\n\t\twebglMain.prototype._eEnterNextStage = function() {\n\t\t\troot.MY.gl.ui.stgInterval().hideTitle();\n\t\t\treturn root.MY.gl.audio.playStgBgm(this._game.stageId());\n\t\t};\n\n\t\twebglMain.prototype._eStartNextStage = function() {\n\t\t\tthis._game.resumeGame();\n\t\t\treturn root.MY.gl.ui.musicTitle().showTitle(this._game.stageId());\n\t\t};\n\n\t\twebglMain.prototype.isPostEffect = function(val) {\n\t\t\tthis._isPostEffect = val;\n\t\t\tif (this._isPostEffect) {\n\t\t\t\treturn this._renderer.setClearColor(this._conf.BG_COLOR[0]);\n\t\t\t} else {\n\t\t\t\treturn this._renderer.setClearColor(this._conf.BG_COLOR[1]);\n\t\t\t}\n\t\t};\n\n\t\treturn webglMain;\n\n\t}"],"file":"about/my_class/webgl_main.js","sourceRoot":"/source/"}