{"version":3,"names":[],"mappings":"","sources":["about/my_class/audio_swf_mgr.js"],"sourcesContent":["export default function() {\n\t\tfunction audioSwfMgr() {\n\t\t\tthis.playStgBgm = bind(this.playStgBgm, this);\n\t\t\tthis.loadStgBgm = bind(this.loadStgBgm, this);\n\t\t\tthis.stgBgmRate = bind(this.stgBgmRate, this);\n\t\t\tthis.getNowBgmTotalFrame = bind(this.getNowBgmTotalFrame, this);\n\t\t\tthis.playSeaUpSe = bind(this.playSeaUpSe, this);\n\t\t\tthis.playSeaDownSe = bind(this.playSeaDownSe, this);\n\t\t\tthis.playItemGetSe = bind(this.playItemGetSe, this);\n\t\t\tthis._checkSwf = bind(this._checkSwf, this);\n\t\t\tthis._eBlurWin = bind(this._eBlurWin, this);\n\t\t\tthis._eFocusWin = bind(this._eFocusWin, this);\n\t\t\tthis._update = bind(this._update, this);\n\t\t\tthis.loadCmnSe = bind(this.loadCmnSe, this);\n\t\t\tthis.start = bind(this.start, this);\n\t\t\tthis._fla;\n\t\t\tthis._conf = root.MY.app.conf;\n\t\t\tthis._vol = 1;\n\t\t\tthis._u = root.MY.myfw.util;\n\t\t\tthis._game;\n\t\t\tthis._nowStageId = -1;\n\t\t\tthis._isCompleteSwf = false;\n\t\t\tthis._stopMs = 0;\n\t\t\tthis._nowStgBgmMs = 0;\n\t\t\tthis._nowStgBgmRateBuf = 0;\n\t\t\tthis._cnt = 0;\n\t\t\tthis._isPlayingStgBgm = false;\n\t\t\tthis.onProgressCmnSound;\n\t\t\tthis.onCompleteCmnSe;\n\t\t\tthis.onCompleteStageBgm;\n\t\t}\n\n\t\taudioSwfMgr.prototype.start = function() {\n\t\t\tthis._game = root.MY.gl.game;\n\t\t\t$(window).focus(this._eFocusWin);\n\t\t\treturn $(window).blur(this._eBlurWin);\n\t\t};\n\n\t\taudioSwfMgr.prototype.loadCmnSe = function() {\n\t\t\tvar attributes, params;\n\t\t\t$(\"body\").prepend(\"<div id='\" + this._conf.SOUND_SWF_ID + \"'></div>\");\n\t\t\tparams = {\n\t\t\t\tallowScriptAccess: \"always\",\n\t\t\t\twmode: \"transparent\"\n\t\t\t};\n\t\t\tattributes = {\n\t\t\t\tid: this._conf.SOUND_SWF_ID,\n\t\t\t\tname: this._conf.SOUND_SWF_ID\n\t\t\t};\n\t\t\tswfobject.embedSWF(this._conf.FILE_SOUND, this._conf.SOUND_SWF_ID, \"1\", \"1\", \"11.0.0\", this._conf.FILE_SWFINSTALL, {}, params, attributes);\n\t\t\t$(\"#\" + this._conf.SOUND_SWF_ID).css({\n\t\t\t\tposition: \"absolute\",\n\t\t\t\ttop: 0,\n\t\t\t\tleft: 0\n\t\t\t});\n\t\t\treturn root.MY.myfw.addUpdate(this._update);\n\t\t};\n\n\t\taudioSwfMgr.prototype._getSwf = function() {\n\t\t\tvar swf;\n\t\t\tswf = $(\"#\" + this._conf.SOUND_SWF_ID);\n\t\t\tif (swf != null) {\n\t\t\t\treturn swf[0];\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t};\n\n\t\taudioSwfMgr.prototype._update = function() {\n\t\t\tvar ease, tgVol;\n\t\t\tif (!this._isCompleteSwf) {\n\t\t\t\tthis._checkSwf();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this._nowStageId !== -1) {\n\t\t\t\tease = 0.1;\n\t\t\t\ttgVol = this._game.life();\n\t\t\t\tthis._vol += (tgVol - this._vol) * ease;\n\t\t\t\tif ((this._fla != null) && (this._fla.setStageBgmVolume != null)) {\n\t\t\t\t\treturn this._fla.setStageBgmVolume(this._nowStageId, this._vol);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\taudioSwfMgr.prototype._eFocusWin = function() {\n\t\t\tif (this._nowStageId !== -1 && !this._isPlayingStgBgm && this._nowStgBgmRateBuf < 1) {\n\t\t\t\tif ((this._fla != null) && (this._fla.stopAllStageBgm != null)) {\n\t\t\t\t\tthis._isPlayingStgBgm = true;\n\t\t\t\t\tthis._fla.playStageBgm(this._nowStageId, this._stopMs);\n\t\t\t\t\tthis._update();\n\t\t\t\t\treturn root.MY.gl.game.isUpdatePoint(true);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\taudioSwfMgr.prototype._eBlurWin = function() {\n\t\t\tif (this._nowStageId !== -1 && this._isPlayingStgBgm && this._nowStgBgmRateBuf < 1) {\n\t\t\t\tif ((this._fla != null) && (this._fla.stopAllStageBgm != null)) {\n\t\t\t\t\tthis._isPlayingStgBgm = false;\n\t\t\t\t\tthis._stopMs = this._fla.getStageBgmPosition(this._nowStageId);\n\t\t\t\t\tthis._fla.stopAllStageBgm();\n\t\t\t\t\treturn root.MY.gl.game.isUpdatePoint(false);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\taudioSwfMgr.prototype._checkSwf = function() {\n\t\t\tvar pct, swf;\n\t\t\tswf = this._getSwf();\n\t\t\tif ((swf != null) && (swf.getProgress != null) && (swf.getIsComplete != null)) {\n\t\t\t\tpct = swf.getProgress();\n\t\t\t\tif (this.onProgressCmnSound != null) {\n\t\t\t\t\tthis.onProgressCmnSound(pct / 100);\n\t\t\t\t}\n\t\t\t\tif (swf.getIsComplete() === \"OK\") {\n\t\t\t\t\tif (this.onProgressCmnSound != null) {\n\t\t\t\t\t\tthis.onProgressCmnSound(1);\n\t\t\t\t\t}\n\t\t\t\t\tif (this.onCompleteCmnSe != null) {\n\t\t\t\t\t\tthis.onCompleteCmnSe();\n\t\t\t\t\t}\n\t\t\t\t\tthis._fla = swf;\n\t\t\t\t\treturn this._isCompleteSwf = true;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\taudioSwfMgr.prototype.playItemGetSe = function(combo) {\n\t\t\tif ((this._fla != null) && (this._fla.playSe != null)) {\n\t\t\t\treturn this._fla.playSe(Math.min(--combo, this._conf.MAX_COMBO - 1));\n\t\t\t}\n\t\t};\n\n\t\taudioSwfMgr.prototype.playSeaDownSe = function() {\n\t\t\tif ((this._fla != null) && (this._fla.playSe != null)) {\n\t\t\t\treturn this._fla.playSe(7);\n\t\t\t}\n\t\t};\n\n\t\taudioSwfMgr.prototype.playSeaUpSe = function() {\n\t\t\tif ((this._fla != null) && (this._fla.playSe != null)) {\n\t\t\t\treturn this._fla.playSe(8);\n\t\t\t}\n\t\t};\n\n\t\taudioSwfMgr.prototype.getNowBgmTotalFrame = function() {\n\t\t\tif ((this._fla != null) && (this._fla.getStageBgmDuration != null)) {\n\t\t\t\treturn this._fla.getStageBgmDuration(this._nowStageId) * 60;\n\t\t\t} else {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t};\n\n\t\taudioSwfMgr.prototype.stgBgmRate = function() {\n\t\t\tif ((this._fla != null) && (this._fla.getStageBgmDuration != null)) {\n\t\t\t\tthis._nowStgBgmRateBuf = this._fla.getStageBgmPosition(this._nowStageId) / this._nowStgBgmMs;\n\t\t\t\treturn this._nowStgBgmRateBuf;\n\t\t\t} else {\n\t\t\t\treturn this._nowStgBgmRateBuf;\n\t\t\t}\n\t\t};\n\n\t\taudioSwfMgr.prototype.loadStgBgm = function(stageId) {\n\t\t\tif (this.onCompleteStageBgm != null) {\n\t\t\t\treturn this.onCompleteStageBgm();\n\t\t\t}\n\t\t};\n\n\t\taudioSwfMgr.prototype.playStgBgm = function(stageId) {\n\t\t\tthis._nowStageId = stageId;\n\t\t\tif ((this._fla != null) && (this._fla.playStageBgm != null) && (this._fla.getStageBgmDuration != null)) {\n\t\t\t\tthis._fla.playStageBgm(this._nowStageId);\n\t\t\t\tthis._nowStgBgmMs = this._fla.getStageBgmDuration(this._nowStageId) * 1000;\n\t\t\t\tthis._nowStgBgmRateBuf = 0;\n\t\t\t\tthis._cnt = 0;\n\t\t\t\tthis._stopMs = 0;\n\t\t\t\tthis._isPlayingStgBgm = true;\n\t\t\t\treturn this._update();\n\t\t\t}\n\t\t};\n\n\t\treturn audioSwfMgr;\n\n\t}"],"file":"about/my_class/audio_swf_mgr.js","sourceRoot":"/source/"}