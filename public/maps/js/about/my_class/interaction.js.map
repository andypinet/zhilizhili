{"version":3,"names":[],"mappings":"","sources":["about/my_class/interaction.js"],"sourcesContent":["export default function() {\n\t\tfunction interaction() {\n\t\t\tthis.mouse = bind(this.mouse, this);\n\t\t\tthis.getNormalizeDeviceAng = bind(this.getNormalizeDeviceAng, this);\n\t\t\tthis.getNormalizeMousePos = bind(this.getNormalizeMousePos, this);\n\t\t\tthis._eDeviceOrientation = bind(this._eDeviceOrientation, this);\n\t\t\tthis._eDeviceMotion = bind(this._eDeviceMotion, this);\n\t\t\tthis._eMouseMove = bind(this._eMouseMove, this);\n\t\t\tthis._eTouchEnd = bind(this._eTouchEnd, this);\n\t\t\tthis._eTouchStart = bind(this._eTouchStart, this);\n\t\t\tthis._eClick = bind(this._eClick, this);\n\t\t\tthis.addOnClick = bind(this.addOnClick, this);\n\t\t\tthis.update = bind(this.update, this);\n\t\t\tthis.start = bind(this.start, this);\n\t\t\tthis._mouse;\n\t\t\tthis._u = root.MY.myfw.util;\n\t\t\tthis._onClick = [];\n\t\t\tthis._device = {\n\t\t\t\tax: 0,\n\t\t\t\tay: 0,\n\t\t\t\taz: 0\n\t\t\t};\n\t\t\tthis._deviceMotionCnt = 0;\n\t\t}\n\n\t\tinteraction.prototype.start = function() {\n\t\t\tthis._mouse = new root.MY_CLASS.mouse();\n\t\t\tthis._mouse.x = root.MY.myfw.stageWidth() * 0.5;\n\t\t\tthis._mouse.y = root.MY.myfw.stageHeight() * 0.5;\n\t\t\tif (root.MY.myfw.conf.IS_SMT) {\n\t\t\t\t$(\"body\").bind(\"touchmove\", this._eMouseMove);\n\t\t\t\t$(\"body\").bind(\"touchstart\", this._eTouchStart);\n\t\t\t\t$(\"body\").bind(\"touchend\", this._eTouchEnd);\n\t\t\t\twindow.addEventListener(\"devicemotion\", this._eDeviceMotion);\n\t\t\t\tthis._mouse.x = -999;\n\t\t\t\tthis._mouse.y = -999;\n\t\t\t} else {\n\t\t\t\t$(\"body\").bind(\"mousemove\", this._eMouseMove);\n\t\t\t\t$(\"body\").bind(\"click\", this._eClick);\n\t\t\t}\n\t\t\treturn root.MY.myfw.addUpdate(this.update);\n\t\t};\n\n\t\tinteraction.prototype.update = function() {\n\t\t\tvar ease;\n\t\t\tif (root.MY.myfw.conf.IS_SMT) {\n\t\t\t\tease = 0.2;\n\t\t\t\tthis._mouse.ax += (this._device.ax - this._mouse.ax) * ease;\n\t\t\t\tthis._mouse.ay += (this._device.ay - this._mouse.ay) * ease;\n\t\t\t\treturn this._mouse.az += (this._device.az - this._mouse.az) * ease;\n\t\t\t}\n\t\t};\n\n\t\tinteraction.prototype.addOnClick = function(f) {\n\t\t\treturn this._onClick.push(f);\n\t\t};\n\n\t\tinteraction.prototype._eClick = function(e) {\n\t\t\tvar i, j, len1, ref, results, val;\n\t\t\tthis._eMouseMove(e);\n\t\t\tref = this._onClick;\n\t\t\tresults = [];\n\t\t\tfor (i = j = 0, len1 = ref.length; j < len1; i = ++j) {\n\t\t\t\tval = ref[i];\n\t\t\t\tif (val != null) {\n\t\t\t\t\tresults.push(val(this._mouse));\n\t\t\t\t} else {\n\t\t\t\t\tresults.push(void 0);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn results;\n\t\t};\n\n\t\tinteraction.prototype._eTouchStart = function(e) {\n\t\t\tvar i, j, len1, ref, results, val;\n\t\t\tthis._mouse.isDown = true;\n\t\t\tthis._eMouseMove(e);\n\t\t\tref = this._onClick;\n\t\t\tresults = [];\n\t\t\tfor (i = j = 0, len1 = ref.length; j < len1; i = ++j) {\n\t\t\t\tval = ref[i];\n\t\t\t\tif (val != null) {\n\t\t\t\t\tresults.push(val(this._mouse));\n\t\t\t\t} else {\n\t\t\t\t\tresults.push(void 0);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn results;\n\t\t};\n\n\t\tinteraction.prototype._eTouchEnd = function(e) {\n\t\t\tthis._mouse.isDown = false;\n\t\t\tthis._mouse.x = -999;\n\t\t\treturn this._mouse.y = -999;\n\t\t};\n\n\t\tinteraction.prototype._eMouseMove = function(e) {\n\t\t\tvar touches;\n\t\t\tif (root.MY.myfw.conf.IS_SMT && this._mouse.isDown) {\n\t\t\t\ttouches = event.touches;\n\t\t\t\tevent.preventDefault();\n\t\t\t\tif ((touches != null) && touches.length > 0) {\n\t\t\t\t\tthis._mouse.xOld = this._mouse.x;\n\t\t\t\t\tthis._mouse.yOld = this._mouse.y;\n\t\t\t\t\tthis._mouse.x = touches[0].pageX;\n\t\t\t\t\treturn this._mouse.y = touches[0].pageY;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._mouse.xOld = this._mouse.x;\n\t\t\t\tthis._mouse.yOld = this._mouse.y;\n\t\t\t\tthis._mouse.x = e.clientX;\n\t\t\t\treturn this._mouse.y = e.clientY;\n\t\t\t}\n\t\t};\n\n\t\tinteraction.prototype._eDeviceMotion = function(e) {\n\t\t\tvar ac, acx, acy, acz, ax, ay, az;\n\t\t\tac = e.accelerationIncludingGravity;\n\t\t\tacx = ac.x;\n\t\t\tacy = ac.y;\n\t\t\tacz = ac.z;\n\t\t\tax = Math.floor(Math.atan2(acx, acz) / Math.PI * 180) || 0;\n\t\t\tay = Math.floor(Math.atan2(acy, acz) / Math.PI * 180) || 0;\n\t\t\taz = Math.floor(Math.atan2(acy, acx) / Math.PI * 180) || 0;\n\t\t\tif (ax < 0) {\n\t\t\t\tax += 360;\n\t\t\t}\n\t\t\tif (ay < 0) {\n\t\t\t\tay += 360;\n\t\t\t}\n\t\t\tif (az < 0) {\n\t\t\t\taz += 360;\n\t\t\t}\n\t\t\tthis._device.ax = ax;\n\t\t\tthis._device.ay = ay;\n\t\t\treturn this._device.az = az;\n\t\t};\n\n\t\tinteraction.prototype._eDeviceOrientation = function(e) {\n\t\t\tvar heading;\n\t\t\theading = e.webkitCompassHeading;\n\t\t\tif (heading != null) {\n\t\t\t\tif (this._mouse.startHeading === 0) {\n\t\t\t\t\tthis._mouse.startHeading = heading;\n\t\t\t\t}\n\t\t\t\tthis._mouse.heading = heading;\n\t\t\t\tthis._mouse.alpha = e.alpha;\n\t\t\t\tthis._mouse.beta = e.beta;\n\t\t\t\treturn this._mouse.gamma = e.gamma;\n\t\t\t}\n\t\t};\n\n\t\tinteraction.prototype.getNormalizeMousePos = function() {\n\t\t\tvar h, w;\n\t\t\tw = root.MY.myfw.stageWidth();\n\t\t\th = root.MY.myfw.stageHeight();\n\t\t\treturn {\n\t\t\t\tx: this._u.map(this._mouse.x, 0, 1, 0, w),\n\t\t\t\ty: this._u.map(this._mouse.y, 0, 1, 0, h)\n\t\t\t};\n\t\t};\n\n\t\tinteraction.prototype.getNormalizeDeviceAng = function() {\n\t\t\tvar baseHeading, dh, h, offsetHeading;\n\t\t\tbaseHeading = 180;\n\t\t\toffsetHeading = baseHeading - this._mouse.startHeading;\n\t\t\th = this._mouse.heading + offsetHeading;\n\t\t\tif (h > 360) {\n\t\t\t\th -= 360;\n\t\t\t}\n\t\t\tif (h < 0) {\n\t\t\t\th += 360;\n\t\t\t}\n\t\t\tdh = h - baseHeading;\n\t\t\tswitch (window.orientation) {\n\t\t\t\tcase 90:\n\t\t\t\t\treturn {\n\t\t\t\t\t\tx: this._u.map(this._mouse.ay, 0, 1, 180 - 360, 180 + 360),\n\t\t\t\t\t\ty: 0.5\n\t\t\t\t\t};\n\t\t\t\tcase -90:\n\t\t\t\t\treturn {\n\t\t\t\t\t\tx: this._u.map(this._mouse.ay, 1, 0, 180 - 360, 180 + 360),\n\t\t\t\t\t\ty: 0.5\n\t\t\t\t\t};\n\t\t\t\tdefault:\n\t\t\t\t\treturn {\n\t\t\t\t\t\tx: this._u.map(this._mouse.ax, 1, 0, 180 - 360, 180 + 360),\n\t\t\t\t\t\ty: 0.5\n\t\t\t\t\t};\n\t\t\t}\n\t\t};\n\n\t\tinteraction.prototype.mouse = function() {\n\t\t\treturn this._mouse;\n\t\t};\n\n\t\treturn interaction;\n\n\t}"],"file":"about/my_class/interaction.js","sourceRoot":"/source/"}