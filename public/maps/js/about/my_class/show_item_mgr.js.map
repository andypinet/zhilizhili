{"version":3,"names":[],"mappings":"","sources":["about/my_class/show_item_mgr.js"],"sourcesContent":["export default function() {\n\t\tfunction showItemMgr(stockItem) {\n\t\t\tthis._spShowItem3 = bind(this._spShowItem3, this);\n\t\t\tthis._spShowItem2 = bind(this._spShowItem2, this);\n\t\t\tthis._spShowItem1 = bind(this._spShowItem1, this);\n\t\t\tthis._spShowItem0 = bind(this._spShowItem0, this);\n\t\t\tthis._setItem = bind(this._setItem, this);\n\t\t\tthis._hideAllItem = bind(this._hideAllItem, this);\n\t\t\tthis.showItem = bind(this.showItem, this);\n\t\t\tthis.makeOffsetTable = bind(this.makeOffsetTable, this);\n\t\t\tthis._isContainStageItem = bind(this._isContainStageItem, this);\n\t\t\tthis._update = bind(this._update, this);\n\t\t\tthis.start = bind(this.start, this);\n\t\t\tthis._stockItem = stockItem;\n\t\t\tthis._parameter;\n\t\t\tthis._u = root.MY.myfw.util;\n\t\t\tthis._offsetTable = [];\n\t\t\tthis._item = [];\n\t\t\tthis._isSmt = root.MY.myfw.conf.IS_SMT;\n\t\t\tthis._device = this._isSmt ? 1 : 0;\n\t\t\tthis._itemSize = {\n\t\t\t\tw: 0,\n\t\t\t\ty: 0\n\t\t\t};\n\t\t\tthis._isShowed = false;\n\t\t\tthis._game;\n\t\t\tthis._conf = root.MY.app.conf;\n\t\t\tthis.onShowItem;\n\t\t}\n\n\t\tshowItemMgr.prototype.start = function() {\n\t\t\tthis._game = root.MY.gl.game;\n\t\t\tthis._parameter = root.MY.gl.parameter;\n\t\t\tthis.makeOffsetTable();\n\t\t\treturn root.MY.myfw.addUpdate(this._update);\n\t\t};\n\n\t\tshowItemMgr.prototype._update = function() {\n\t\t\tif (this._isShowed) {\n\t\t\t\tif (!this._isContainStageItem()) {\n\t\t\t\t\treturn this._isShowed = false;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tshowItemMgr.prototype._isContainStageItem = function() {\n\t\t\tvar cnt, i, j, len1, ref, val;\n\t\t\tcnt = 0;\n\t\t\tref = this._item;\n\t\t\tfor (i = j = 0, len1 = ref.length; j < len1; i = ++j) {\n\t\t\t\tval = ref[i];\n\t\t\t\tif ((val != null) && !val.isContainStage()) {\n\t\t\t\t\tcnt++;\n\t\t\t\t} else {\n\t\t\t\t\tif (val == null) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn cnt < this._item.length;\n\t\t};\n\n\t\tshowItemMgr.prototype.makeOffsetTable = function() {\n\t\t\tvar ix, iy, obj, results, xLen, xRange, yLen, yRange;\n\t\t\tthis._offsetTable = [];\n\t\t\tthis._itemSize.w = this._itemSize.h = [80, 30][this._device];\n\t\t\txRange = this._parameter.get(\"itemRangeX\") * 2;\n\t\t\tyRange = this._parameter.get(\"itemRangeY\");\n\t\t\tix = 0;\n\t\t\tiy = 0;\n\t\t\txLen = ~~(xRange / this._itemSize.w);\n\t\t\tyLen = ~~(yRange / this._itemSize.h);\n\t\t\tresults = [];\n\t\t\twhile (ix < xLen) {\n\t\t\t\tiy = 0;\n\t\t\t\twhile (iy < yLen) {\n\t\t\t\t\tobj = {};\n\t\t\t\t\tobj.x = ix * this._itemSize.w - xRange * 0.5;\n\t\t\t\t\tobj.y = iy * this._itemSize.h;\n\t\t\t\t\tthis._offsetTable.push(obj);\n\t\t\t\t\tiy++;\n\t\t\t\t}\n\t\t\t\tresults.push(ix++);\n\t\t\t}\n\t\t\treturn results;\n\t\t};\n\n\t\tshowItemMgr.prototype.showItem = function(at) {\n\t\t\tvar i, num, offset;\n\t\t\tif (this._isShowed) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis._isShowed = true;\n\t\t\tthis._hideAllItem();\n\t\t\tif (this._u.hit(10)) {\n\t\t\t\tthis._u.arrRand([this._spShowItem0, this._spShowItem1, this._spShowItem1, this._spShowItem2, this._spShowItem3])(at);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._u.shuffle(this._offsetTable);\n\t\t\tnum = this._parameter.get(\"item\");\n\t\t\tif (this._conf.IS_CAP) {\n\t\t\t\tnum = 7;\n\t\t\t}\n\t\t\tthis._item = [];\n\t\t\ti = 0;\n\t\t\twhile (i < num) {\n\t\t\t\toffset = this._offsetTable[i];\n\t\t\t\tif (this.onShowItem != null) {\n\t\t\t\t\tthis._setItem(at, offset.x, offset.y, i, true);\n\t\t\t\t}\n\t\t\t\ti++;\n\t\t\t}\n\t\t\treturn true;\n\t\t};\n\n\t\tshowItemMgr.prototype._hideAllItem = function() {\n\t\t\tvar i, j, len1, ref, results, val;\n\t\t\tref = this._stockItem;\n\t\t\tresults = [];\n\t\t\tfor (i = j = 0, len1 = ref.length; j < len1; i = ++j) {\n\t\t\t\tval = ref[i];\n\t\t\t\tresults.push(val.hide());\n\t\t\t}\n\t\t\treturn results;\n\t\t};\n\n\t\tshowItemMgr.prototype._setItem = function(t, itemX, itemY, i, offset, interval, zOffset) {\n\t\t\tif (zOffset == null) {\n\t\t\t\tzOffset = 0;\n\t\t\t}\n\t\t\tif ((offset != null) && offset) {\n\t\t\t\titemX += root.MY.myfw.util.range(10);\n\t\t\t\titemY += root.MY.myfw.util.range(10);\n\t\t\t}\n\t\t\tif (this._isSmt && Math.abs(window.orientation) === 90) {\n\t\t\t\titemX *= 2;\n\t\t\t\titemY *= 1;\n\t\t\t}\n\t\t\treturn this._item.push(this.onShowItem(t, itemX, itemY, i, interval, zOffset));\n\t\t};\n\n\t\tshowItemMgr.prototype._spShowItem0 = function(t) {\n\t\t\tvar cy, i, isSpiral, itemX, itemY, num, rad, radius, results, start;\n\t\t\tradius = [150, 100][this._device];\n\t\t\tcy = [80, 50][this._device];\n\t\t\tstart = this._u.range(180);\n\t\t\tisSpiral = this._u.hit(2);\n\t\t\tnum = this._conf.MAX_COMBO;\n\t\t\ti = 0;\n\t\t\tresults = [];\n\t\t\twhile (i < num) {\n\t\t\t\trad = start + this._u.radian(360 / num * i);\n\t\t\t\titemX = Math.sin(rad) * radius;\n\t\t\t\titemY = cy + Math.cos(rad) * radius;\n\t\t\t\tthis._setItem(t, itemX, itemY, i, false, 3, isSpiral ? 0 : -300 + i * 200);\n\t\t\t\tresults.push(i++);\n\t\t\t}\n\t\t\treturn results;\n\t\t};\n\n\t\tshowItemMgr.prototype._spShowItem1 = function(t) {\n\t\t\tvar cy, d, i, itemX, itemY, num, rad, radius, results, start, x;\n\t\t\tradius = [100, 50][this._device];\n\t\t\tcy = [80, 50][this._device];\n\t\t\tstart = this._u.range(180);\n\t\t\tif (this._u.hit(3)) {\n\t\t\t\tradius = 0;\n\t\t\t}\n\t\t\tx = -this._parameter.get(\"itemRangeX\");\n\t\t\tnum = this._conf.MAX_COMBO;\n\t\t\ti = 0;\n\t\t\tresults = [];\n\t\t\twhile (i < num) {\n\t\t\t\trad = start + this._u.radian(360 / num * i);\n\t\t\t\td = Math.abs(x * 2) / num;\n\t\t\t\titemX = x + d * i + d * 0.5;\n\t\t\t\titemY = cy + Math.sin(rad) * radius;\n\t\t\t\tthis._setItem(t, itemX, itemY, i, false, 3);\n\t\t\t\tresults.push(i++);\n\t\t\t}\n\t\t\treturn results;\n\t\t};\n\n\t\tshowItemMgr.prototype._spShowItem2 = function(t) {\n\t\t\tvar h, i, itemX, itemY, j, len1, ofstx, ofsty, results, strTable, use, val, w;\n\t\t\tstrTable = [[[0, 1], [0.25, 0.6], [0.5, 0], [0.75, 0.6], [1, 1], [0.45, 0.6], [0.55, 0.6]], [[0, 0], [0.25, 0.25], [0.5, 0.5], [1, 0], [0.75, 0.25], [0.5, 0.75], [0.5, 1]], [[1, 0], [1, 0.5], [1, 1], [0, 0], [0.5, 0.35], [0.5, 0.65], [0, 1]], [[0.5, 0.5], [0, 0], [0.5, 0], [1, 0], [0.75, 0.5], [0.5, 1], [0.25, 0.5]]];\n\t\t\tuse = this._u.arrRand(strTable);\n\t\t\tofstx = [0, 0][this._device];\n\t\t\tofsty = [90, 50][this._device];\n\t\t\tw = this._parameter.get(\"itemRangeX\") * 2 * [0.25, 0.5][this._device];\n\t\t\th = this._parameter.get(\"itemRangeY\") * 2 * [0.5, 0.5][this._device];\n\t\t\tresults = [];\n\t\t\tfor (i = j = 0, len1 = use.length; j < len1; i = ++j) {\n\t\t\t\tval = use[i];\n\t\t\t\titemX = val[0] * w - w * 0.5;\n\t\t\t\titemY = ofsty + -val[1] * h + h * 0.5;\n\t\t\t\tthis._setItem(t, itemX, itemY, i, false, 3);\n\t\t\t\tresults.push(i++);\n\t\t\t}\n\t\t\treturn results;\n\t\t};\n\n\t\tshowItemMgr.prototype._spShowItem3 = function(t) {\n\t\t\tvar cy, d, i, itemX, itemY, num, rad, radius, results, x;\n\t\t\tradius = [100, 50][this._device];\n\t\t\tcy = [80, 50][this._device];\n\t\t\tx = -this._parameter.get(\"itemRangeX\");\n\t\t\tnum = this._conf.MAX_COMBO;\n\t\t\ti = 0;\n\t\t\tresults = [];\n\t\t\twhile (i < num) {\n\t\t\t\trad = this._u.radian(270 * i);\n\t\t\t\td = Math.abs(x * 2) / num;\n\t\t\t\titemX = x + d * i + d * 0.5;\n\t\t\t\titemY = cy + Math.sin(rad) * radius;\n\t\t\t\tthis._setItem(t, itemX, itemY, i, false, 3);\n\t\t\t\tresults.push(i++);\n\t\t\t}\n\t\t\treturn results;\n\t\t};\n\n\t\treturn showItemMgr;\n\n\t}"],"file":"about/my_class/show_item_mgr.js","sourceRoot":"/source/"}